<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muse Mirror</title>
    <style>
        @import url('https://fonts.cdnjs.com/css2?family=Inter:wght@300;400&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: white;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: relative;
        }

        #fixed-center {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
        }

        #input-line {
            display: flex;
            align-items: center;
            height: 30px;
        }

        #displayed-text {
            font-weight: 300;
            font-size: 20px;
            letter-spacing: -0.01em;
            color: #333;
            white-space: pre;
        }

        #cursor {
            display: inline-block;
            width: 2px;
            height: 24px;
            background-color: #333;
            animation: breathe 4.5s infinite ease-in-out;
            margin-left: 1px;
        }

        @keyframes breathe {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        #hidden-input {
            position: absolute;
            opacity: 0;
            height: 0;
            width: 0;
        }

        #conversation {
            position: absolute;
            width: 100%;
            max-height: 45vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse;
            bottom: 100%;
            margin-bottom: 10px;
        }

        .conversation-item {
            margin-bottom: 10px;
            font-size: 20px;
            letter-spacing: -0.01em;
            font-weight: 300;
            line-height: 1.5;
            text-align: left;
        }

        .user-text { 
            color: #333;
        }
        
        .response-text { 
            color: #666;
            opacity: 0;
            animation: fadeIn 2s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="fixed-center">
        <div id="conversation"></div>
        <div id="input-line">
            <span id="displayed-text"></span>
            <span id="cursor"></span>
            <input type="text" id="hidden-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        </div>
    </div>

    <script>
        const hiddenInput = document.getElementById('hidden-input');
        const displayedText = document.getElementById('displayed-text');
        const conversation = document.getElementById('conversation');
        const inputLine = document.getElementById('input-line');

        function focusInput() {
            hiddenInput.focus();
        }

        window.onload = focusInput;
        document.addEventListener('click', focusInput);
        inputLine.addEventListener('click', focusInput);

        hiddenInput.addEventListener('input', () => {
            displayedText.textContent = hiddenInput.value;
        });

        hiddenInput.addEventListener('keydown', async (e) => {
            if (e.key === 'Enter' && hiddenInput.value.trim() !== '') {
                e.preventDefault();

                const userText = hiddenInput.value.trim();
                
                // Create user message element
                const userItem = document.createElement('div');
                userItem.classList.add('conversation-item', 'user-text');
                userItem.textContent = userText;
                
                // Clear input
                hiddenInput.value = '';
                displayedText.textContent = '';
                
                // Add the message to conversation
                conversation.prepend(userItem);

                const randomDelay = Math.floor(Math.random() * 3000) + 1000;
                await new Promise(resolve => setTimeout(resolve, randomDelay));

                try {
                    const response = await fetch('/api/mirror', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: userText })
                    });

                    const data = await response.json();

                    const responseItem = document.createElement('div');
                    responseItem.classList.add('conversation-item', 'response-text');
                    responseItem.textContent = data.reply;
                    conversation.prepend(responseItem);

                } catch (error) {
                    console.error('Error:', error);
                    
                    // Fallback in case API fails
                    const fallbackResponses = [
                        "The quietest answer is often the most profound.",
                        "Your words create the space between thoughts.",
                        "Reflections aren't answersâ€”they're continuations of questions.",
                        "What if the question itself is the journey?",
                        "Sometimes clarity comes from simply hearing yourself think.",
                        "In stillness, even incomplete thoughts find their meaning.",
                        "The mirror doesn't judge what it reflects.",
                        "Your voice carries more wisdom than you realize.",
                        "Between intention and expression lies a universe of meaning.",
                        "The pause after a thought is where understanding begins."
                    ];
                    
                    const responseItem = document.createElement('div');
                    responseItem.classList.add('conversation-item', 'response-text');
                    responseItem.textContent = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
                    conversation.prepend(responseItem);
                }
            }
        });
    </script>
</body>
</html>